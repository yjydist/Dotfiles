# ==========================================
# åŸºç¡€è®¾ç½® (General)
# ==========================================

# æ··åˆç«¯å£ (HTTPå’ŒSOCKS5å…±ç”¨)ï¼Œå³æ‰‹åŠ¨è®¾ç½®ä»£ç†æ—¶å¡«çš„ç«¯å£
mixed-port: 7890

# å…è®¸å±€åŸŸç½‘è¿æ¥ (æ‰‹æœºè¿ä½ ç”µè„‘ä»£ç†)
allow-lan: true

# ç»‘å®šåœ°å€ï¼Œ* ä»£è¡¨å…è®¸æ‰€æœ‰è®¾å¤‡è®¿é—®
bind-address: "*"

# è¿è¡Œæ¨¡å¼: rule (è§„åˆ™æ¨¡å¼ - æ¨è), global (å…¨å±€), direct (ç›´è¿)
mode: rule

# [è°ƒè¯•å…³é”®] æ—¥å¿—çº§åˆ«
# å¹³æ—¶ç”¨ infoï¼Œå¦‚æœå‡ºé—®é¢˜æ”¹æˆ debug å¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„æŠ¥é”™
log-level: info

# å¼€å¯ IPv6 (å¦‚æœä½ çš„æ¢¯å­èŠ‚ç‚¹æ”¯æŒIPv6ï¼Œå¼€å¯å¯æé«˜è¿æ¥æˆåŠŸç‡ï¼Œå¦åˆ™å¯èƒ½æ‹–æ…¢é€Ÿåº¦)
ipv6: true

# å¤–éƒ¨æ§åˆ¶ API (Web é¢æ¿é€šä¿¡ç«¯å£)
external-controller: 127.0.0.1:9090

# Web é¢æ¿æ–‡ä»¶å¤¹è·¯å¾„ (Mihomo ä¼šè‡ªåŠ¨åœ¨è¿™ä¸ªè·¯å¾„æ‰¾ç½‘é¡µæ–‡ä»¶)
external-ui: ui

# é¢æ¿ä¸‹è½½åœ°å€ (ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½é¢æ¿)
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"

# æ•°æ®åº“æ¨¡å¼ (GeoIP/GeoSite)ï¼Œä¿æŒé»˜è®¤å³å¯
geodata-mode: true
geox-url:
  # GeoIP (å›½å®¶åº“) - CDN åŠ é€Ÿ
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  # GeoSite (åŸŸååˆ†ç±»åº“) - CDN åŠ é€Ÿ
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  # MMDB (é€šç”¨æ ¼å¼åº“) - CDN åŠ é€Ÿ
  mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  # ASN (è¿è¥å•†åº“) - CDN åŠ é€Ÿ
  asn: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb"

# è¿›ç¨‹åŒ¹é…æ¨¡å¼ (ç”¨äºè®©è§„åˆ™åŒ¹é…å…·ä½“æ˜¯å“ªä¸ªè½¯ä»¶å‘å‡ºçš„è¯·æ±‚)
find-process-mode: strict
client-fingerprint: chrome

# ç¼“å­˜è®¾ç½® (é‡å¯åè®°å¾—ä¸Šæ¬¡é€‰çš„èŠ‚ç‚¹)
profile:
  store-selected: true
  store-fake-ip: true

# å—…æ¢å™¨ (è®©å†…æ ¸çŸ¥é“ HTTPS åŒ…é‡Œè®¿é—®çš„æ˜¯ä»€ä¹ˆåŸŸåï¼Œç”¨äºå‡†ç¡®åˆ†æµ)
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com" # è‹¹æœæ¨é€ä¸å—…æ¢ï¼Œé˜²æ­¢å»¶è¿Ÿ

# ==========================================
# [å…³é”®ä¿®æ”¹] TUN æ¨¡å¼è®¾ç½®
# ==========================================
tun:
  # [ä¿®æ”¹ç‚¹1] å¿…é¡»å¼€å¯ï¼Œå¦åˆ™æ— æ³•æ¥ç®¡ç³»ç»Ÿæµé‡
  enable: false

  # [ä¿®æ”¹ç‚¹2] macOS æ¨èä½¿ç”¨ system æ ˆï¼Œæ€§èƒ½æ¯” mixed æ›´å¥½ï¼ŒCPUå ç”¨æ›´ä½
  stack: system

  # DNS åŠ«æŒï¼šå¼ºåˆ¶æ‹¦æˆªæ‰€æœ‰å‘å¾€ 53 ç«¯å£çš„ DNS è¯·æ±‚
  dns-hijack:
    - "any:53"
    - "tcp://any:53"

  # è‡ªåŠ¨é…ç½®è·¯ç”±è¡¨ (è®©æµé‡æµå‘è™šæ‹Ÿç½‘å¡)
  auto-route: true

  # è‡ªåŠ¨é…ç½®è·¯ç”±è§„åˆ™
  auto-redirect: true

  # è‡ªåŠ¨æ£€æµ‹ç½‘å¡ (é˜²æ­¢å¤šç½‘å¡å†²çª)
  auto-detect-interface: true

# ==========================================
# [å…³é”®ä¿®æ”¹] DNS è®¾ç½®
# ==========================================
dns:
  enable: true
  ipv6: true

  # [ä¿®æ”¹ç‚¹3] æ˜¾å¼æŒ‡å®šç›‘å¬ç«¯å£ï¼Œé˜²æ­¢å†²çª
  listen: 0.0.0.0:1053

  # æ¨¡å¼ï¼šfake-ip (æœ€å¿«æ¨¡å¼ï¼Œç«‹å³è¿”å›å‡ IPï¼Œé˜²æ­¢ DNS æ±¡æŸ“)
  enhanced-mode: fake-ip

  # å‡ IP æ±  (ä¸€èˆ¬ä¸éœ€è¦åŠ¨)
  fake-ip-range: 198.18.0.1/16

  # [ä¿®æ”¹ç‚¹4] è¿‡æ»¤åˆ—è¡¨ï¼šç»å¯¹ä¸èƒ½æ”¾ "*" !!!
  # è¿™é‡Œçš„åŸŸåä¼šè¿”å›çœŸå® IPï¼Œå…¶ä»–çš„éƒ½è¿”å›å‡ IP
  fake-ip-filter:
    # - "*"               <-- åˆ é™¤äº†è¿™ä¸€è¡Œï¼Œè¿™æ˜¯å¯¼è‡´ä½ ä¹‹å‰ DNS å¼‚å¸¸çš„å…ƒå‡¶
    - "+.lan" # å±€åŸŸç½‘
    - "+.local" # æœ¬åœ°
    - "+.market.xiaomi.com"
    - "localhost"

  # é»˜è®¤ DNS (ç”¨äºè§£æ DoH åŸŸåçš„ IP)
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29

  # æ ¸å¿ƒ DNS (æ¨èä½¿ç”¨åŠ å¯† DNSï¼Œé˜²æ­¢è¿è¥å•†å·çœ‹/åŠ«æŒ)
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query

# ==========================================
# ä»£ç†è®¢é˜… (ä¿æŒä½ åŸæ¥çš„)
# ==========================================
proxy-providers:
  SSRDOG:
    # è®°å¾—ä¿ç•™ä½ è‡ªå·±çš„ URL
    url: "https://cbe6427a9e78b5de4b6b8ed90f4a38a1.cdn-res-oss-cn-hongkong-aliyuncs-file.com/s?t=cbe6427a9e78b5de4b6b8ed90f4a38a1.jpg"
    type: http
    interval: 86400
    health-check:
      enable: true
      url: "https://www.gstatic.com/generate_204"
      interval: 300
    override:
      additional-prefix: "[SSRDOG]"

proxies:
  - name: "ç›´è¿"
    type: direct
    udp: true

# ==========================================
# ç­–ç•¥ç»„ (ä¿æŒä½ åŸæ¥çš„)
# ==========================================
proxy-groups:
  - name: é»˜è®¤
    type: select
    proxies:
      [è‡ªåŠ¨é€‰æ‹©, ç›´è¿, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹]

  - name: Google
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: Telegram
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: Twitter
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: å“”å“©å“”å“©
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: å·´å“ˆå§†ç‰¹
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: YouTube
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: NETFLIX
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: Spotify
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: Github
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: Steam
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  - name: å›½å†…
    type: select
    proxies:
      [ç›´è¿, é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©]

  - name: å…¶ä»–
    type: select
    proxies:
      [é»˜è®¤, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, ç›´è¿]

  # --- åœ°åŒºåˆ†ç»„ ---
  - name: é¦™æ¸¯
    type: select
    include-all: true
    exclude-type: direct
    filter: "(?i)æ¸¯|hk|hongkong|hong kong"

  - name: å°æ¹¾
    type: select
    include-all: true
    exclude-type: direct
    filter: "(?i)å°|tw|taiwan"

  - name: æ—¥æœ¬
    type: select
    include-all: true
    exclude-type: direct
    filter: "(?i)æ—¥|jp|japan"

  - name: ç¾å›½
    type: select
    include-all: true
    exclude-type: direct
    filter: "(?i)ç¾|us|unitedstates|united states"

  - name: æ–°åŠ å¡
    type: select
    include-all: true
    exclude-type: direct
    filter: "(?i)(æ–°|sg|singapore)"

  - name: å…¶å®ƒåœ°åŒº
    type: select
    include-all: true
    exclude-type: direct
    filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"

  - name: å…¨éƒ¨èŠ‚ç‚¹
    type: select
    include-all: true
    exclude-type: direct

  - name: è‡ªåŠ¨é€‰æ‹©
    type: url-test
    include-all: true
    exclude-type: direct
    tolerance: 10

# ==========================================
# è§„åˆ™ (ä¿æŒä½ åŸæ¥çš„)
# ==========================================
rules:
  - GEOIP,lan,ç›´è¿,no-resolve
  - GEOSITE,github,Github
  - GEOSITE,twitter,Twitter
  - GEOSITE,youtube,YouTube
  - GEOSITE,google,Google
  - GEOSITE,telegram,Telegram
  - GEOSITE,netflix,NETFLIX
  - GEOSITE,bilibili,å“”å“©å“”å“©
  - GEOSITE,bahamut,å·´å“ˆå§†ç‰¹
  - GEOSITE,spotify,Spotify
  - DOMAIN-SUFFIX,steampowered.com,Steam
  - DOMAIN-SUFFIX,steamcommunity.com,Steam
  - DOMAIN-SUFFIX,steamstatic.com,Steam
  - GEOSITE,CN,å›½å†…
  - GEOSITE,geolocation-!cn,å…¶ä»–

  - GEOIP,google,Google
  - GEOIP,netflix,NETFLIX
  - GEOIP,telegram,Telegram
  - GEOIP,twitter,Twitter
  - GEOIP,CN,å›½å†…
  - MATCH,å…¶ä»–
