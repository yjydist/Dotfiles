import{Ct as e,K as t,St as n,Tt as r,_ as i,a,b as o,bt as s,c,d as l,f as u,g as d,h as f,i as p,it as m,l as h,m as g,n as _,o as v,p as y,pt as b,r as x,rt as S,s as C,t as w,u as T,v as E,vt as D,y as O,yt as k}from"./DO0JR7ER.js";import{_ as A}from"./Ch85hcd-.js";var j=class extends o{constructor(e,t){super(),this.options=t,this.#e=e,this.#s=null,this.#o=C(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#n=void 0;#r=void 0;#i;#a;#o;#s;#c;#l;#u;#d;#f;#p;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),N(this.#t,this.options)?this.#h():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return P(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return P(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#x(),this.#t.removeObserver(this)}setOptions(e){let t=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!=`boolean`&&typeof this.options.enabled!=`function`&&typeof g(this.options.enabled,this.#t)!=`boolean`)throw Error(`Expected enabled to be a boolean or a callback that returns a boolean`);this.#S(),this.#t.setOptions(this.options),t._defaulted&&!d(this.options,t)&&this.#e.getQueryCache().notify({type:`observerOptionsUpdated`,query:this.#t,observer:this});let r=this.hasListeners();r&&F(this.#t,n,this.options,t)&&this.#h(),this.updateResult(),r&&(this.#t!==n||g(this.options.enabled,this.#t)!==g(t.enabled,this.#t)||f(this.options.staleTime,this.#t)!==f(t.staleTime,this.#t))&&this.#g();let i=this.#_();r&&(this.#t!==n||g(this.options.enabled,this.#t)!==g(t.enabled,this.#t)||i!==this.#p)&&this.#v(i)}getOptimisticResult(e){let t=this.#e.getQueryCache().build(this.#e,e),n=this.createResult(t,e);return L(this,n)&&(this.#r=n,this.#a=this.options,this.#i=this.#t.state),n}getCurrentResult(){return this.#r}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),t?.(n),n===`promise`&&(this.trackProp(`data`),!this.options.experimental_prefetchInRender&&this.#o.status===`pending`&&this.#o.reject(Error(`experimental_prefetchInRender feature flag is not enabled`))),Reflect.get(e,n))})}trackProp(e){this.#m.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),n=this.#e.getQueryCache().build(this.#e,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#h({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#h(e){this.#S();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(u)),t}#g(){this.#b();let e=f(this.options.staleTime,this.#t);if(T||this.#r.isStale||!l(e))return;let t=E(this.#r.dataUpdatedAt,e)+1;this.#d=O.setTimeout(()=>{this.#r.isStale||this.updateResult()},t)}#_(){return(typeof this.options.refetchInterval==`function`?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#v(e){this.#x(),this.#p=e,!(T||g(this.options.enabled,this.#t)===!1||!l(this.#p)||this.#p===0)&&(this.#f=O.setInterval(()=>{(this.options.refetchIntervalInBackground||c.isFocused())&&this.#h()},this.#p))}#y(){this.#g(),this.#v(this.#_())}#b(){this.#d&&=(O.clearTimeout(this.#d),void 0)}#x(){this.#f&&=(O.clearInterval(this.#f),void 0)}createResult(e,t){let n=this.#t,r=this.options,i=this.#r,o=this.#i,s=this.#a,c=e===n?this.#n:e.state,{state:l}=e,u={...l},d=!1,f;if(t._optimisticResults){let i=this.hasListeners(),o=!i&&N(e,t),s=i&&F(e,n,t,r);(o||s)&&(u={...u,...a(l.data,e.options)}),t._optimisticResults===`isRestoring`&&(u.fetchStatus=`idle`)}let{error:p,errorUpdatedAt:m,status:h}=u;f=u.data;let _=!1;if(t.placeholderData!==void 0&&f===void 0&&h===`pending`){let e;i?.isPlaceholderData&&t.placeholderData===s?.placeholderData?(e=i.data,_=!0):e=typeof t.placeholderData==`function`?t.placeholderData(this.#u?.state.data,this.#u):t.placeholderData,e!==void 0&&(h=`success`,f=y(i?.data,e,t),d=!0)}if(t.select&&f!==void 0&&!_)if(i&&f===o?.data&&t.select===this.#c)f=this.#l;else try{this.#c=t.select,f=t.select(f),f=y(i?.data,f,t),this.#l=f,this.#s=null}catch(e){this.#s=e}this.#s&&(p=this.#s,f=this.#l,m=Date.now(),h=`error`);let v=u.fetchStatus===`fetching`,b=h===`pending`,x=h===`error`,S=b&&v,w=f!==void 0,T={status:h,fetchStatus:u.fetchStatus,isPending:b,isSuccess:h===`success`,isError:x,isInitialLoading:S,isLoading:S,data:f,dataUpdatedAt:u.dataUpdatedAt,error:p,errorUpdatedAt:m,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>c.dataUpdateCount||u.errorUpdateCount>c.errorUpdateCount,isFetching:v,isRefetching:v&&!b,isLoadingError:x&&!w,isPaused:u.fetchStatus===`paused`,isPlaceholderData:d,isRefetchError:x&&w,isStale:I(e,t),refetch:this.refetch,promise:this.#o,isEnabled:g(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){let t=T.data!==void 0,r=T.status===`error`&&!t,i=e=>{r?e.reject(T.error):t&&e.resolve(T.data)},a=()=>{i(this.#o=T.promise=C())},o=this.#o;switch(o.status){case`pending`:e.queryHash===n.queryHash&&i(o);break;case`fulfilled`:(r||T.data!==o.value)&&a();break;case`rejected`:(!r||T.error!==o.reason)&&a();break}}return T}updateResult(){let e=this.#r,t=this.createResult(this.#t,this.options);this.#i=this.#t.state,this.#a=this.options,this.#i.data!==void 0&&(this.#u=this.#t),!d(t,e)&&(this.#r=t,this.#C({listeners:(()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,n=typeof t==`function`?t():t;if(n===`all`||!n&&!this.#m.size)return!0;let r=new Set(n??this.#m);return this.options.throwOnError&&r.add(`error`),Object.keys(this.#r).some(t=>{let n=t;return this.#r[n]!==e[n]&&r.has(n)})})()}))}#S(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;let t=this.#t;this.#t=e,this.#n=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#C(e){v.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:`observerResultsUpdated`})})}};function M(e,t){return g(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status===`error`&&t.retryOnMount===!1)}function N(e,t){return M(e,t)||e.state.data!==void 0&&P(e,t,t.refetchOnMount)}function P(e,t,n){if(g(t.enabled,e)!==!1&&f(t.staleTime,e)!==`static`){let r=typeof n==`function`?n(e):n;return r===`always`||r!==!1&&I(e,t)}return!1}function F(e,t,n,r){return(e!==t||g(r.enabled,e)===!1)&&(!n.suspense||e.state.status!==`error`)&&I(e,n)}function I(e,t){return g(t.enabled,e)!==!1&&e.isStaleByTime(f(t.staleTime,e))}function L(e,t){return!d(e.getCurrentResult(),t)}var R=class extends o{#e;#t=void 0;#n;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),d(this.options,t)||this.#e.getMutationCache().notify({type:`observerOptionsUpdated`,mutation:this.#n,observer:this}),t?.mutationKey&&this.options.mutationKey&&h(t.mutationKey)!==h(this.options.mutationKey)?this.reset():this.#n?.state.status===`pending`&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#i(),this.#a()}mutate(e,t){return this.#r=t,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#i(){let e=this.#n?.state??p();this.#t={...e,isPending:e.status===`pending`,isSuccess:e.status===`success`,isError:e.status===`error`,isIdle:e.status===`idle`,mutate:this.mutate,reset:this.reset}}#a(e){v.batch(()=>{if(this.#r&&this.hasListeners()){let t=this.#t.variables,n=this.#t.context,r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type===`success`){try{this.#r.onSuccess?.(e.data,t,n,r)}catch(e){Promise.reject(e)}try{this.#r.onSettled?.(e.data,null,t,n,r)}catch(e){Promise.reject(e)}}else if(e?.type===`error`){try{this.#r.onError?.(e.error,t,n,r)}catch(e){Promise.reject(e)}try{this.#r.onSettled?.(void 0,e.error,t,n,r)}catch(e){Promise.reject(e)}}}this.listeners.forEach(e=>{e(this.#t)})})}};function z(e=``){if(!S())throw Error(`vue-query hooks can only be used inside setup() function or functions that support injection context.`);let t=m(_(e));if(!t)throw Error(`No 'queryClient' found in Vue context, use 'VueQueryPlugin' to properly initialize the library.`);return t}function B(a,o,c){let l=c||z(),u=t(()=>{let e=o;typeof e==`function`&&(e=e());let t=w(e);typeof t.enabled==`function`&&(t.enabled=t.enabled());let n=l.defaultQueryOptions(t);return n._optimisticResults=l.isRestoring?.value?`isRestoring`:`optimistic`,n}),d=new a(l,u.value),f=u.value.shallow?n(d.getCurrentResult()):k(d.getCurrentResult()),p=()=>{};l.isRestoring&&b(l.isRestoring,e=>{e||(p(),p=d.subscribe(e=>{x(f,e)}))},{immediate:!0});let m=()=>{d.setOptions(u.value),x(f,d.getCurrentResult())};b(u,m),D(()=>{p()});let h=(...e)=>(m(),f.refetch(...e)),g=()=>new Promise((e,t)=>{let n=()=>{},r=()=>{if(u.value.enabled!==!1){d.setOptions(u.value);let r=d.getOptimisticResult(u.value);r.isStale?(n(),d.fetchOptimistic(u.value).then(e,n=>{i(u.value.throwOnError,[n,d.getCurrentQuery()])?t(n):e(d.getCurrentResult())})):(n(),e(r))}};r(),n=b(u,r)});b(()=>f.error,e=>{if(f.isError&&!f.isFetching&&i(u.value.throwOnError,[e,d.getCurrentQuery()]))throw e});let _=r(u.value.shallow?e(f):s(f));for(let e in f)typeof f[e]==`function`&&(_[e]=f[e]);return _.suspense=g,_.refetch=h,_}function V(e,t){return B(j,e,t)}function H(a,o){let c=o||z(),l=t(()=>{let e=typeof a==`function`?a():a;return c.defaultMutationOptions(w(e))}),u=new R(c,l.value),d=l.value.shallow?n(u.getCurrentResult()):k(u.getCurrentResult()),f=u.subscribe(e=>{x(d,e)}),p=(e,t)=>{u.mutate(e,t).catch(()=>{})};b(l,()=>{u.setOptions(l.value)}),D(()=>{f()});let m=r(l.value.shallow?e(d):s(d));return b(()=>d.error,e=>{if(e&&i(l.value.throwOnError,[e]))throw e}),{...m,mutate:p,mutateAsync:d.mutate,reset:d.reset}}function U(){return A()}const W={proxies:[`proxies`],proxyProviders:[`proxy-providers`],rules:[`rules`],ruleProviders:[`rule-providers`],config:[`config`],version:[`version`]};function G(){return V({queryKey:W.rules,queryFn:async()=>{let{rules:e}=await U().get(`rules`).json();return Object.values(e)}})}function K(){return V({queryKey:W.ruleProviders,queryFn:async()=>{let{providers:e}=await U().get(`providers/rules`).json();return Object.values(e)}})}function q(){let e=z();return H({mutationFn:async e=>{await U().put(`providers/rules/${encodeURIComponent(e)}`)},onSuccess:()=>{e.invalidateQueries({queryKey:W.rules}),e.invalidateQueries({queryKey:W.ruleProviders})}})}function J(){return V({queryKey:W.config,queryFn:async()=>U().get(`configs`).json()})}function Y(){let e=z();return H({mutationFn:async({key:e,value:t})=>{await U().patch(`configs`,{json:{[e]:t}})},onSuccess:()=>{e.invalidateQueries({queryKey:W.config})}})}function X(){return V({queryKey:W.version,queryFn:async()=>{let{version:e}=await U().get(`version`).json();return e}})}export{q as a,Y as i,K as n,X as o,G as r,H as s,J as t};