import"./BkvRS_rx.js";import{At as e,C as t,D as n,E as r,F as i,G as a,H as o,I as s,J as c,K as l,O as u,Ot as d,Pt as f,R as p,S as m,U as h,W as g,X as _,Y as v,at as y,ct as b,dt as x,et as S,ft as C,ht as w,jt as T,k as E,kt as D,lt as O,mt as k,ot as ee,pt as A,q as j,st as M,tt as N,ut as P,x as F,xt as I}from"./DO0JR7ER.js";import{m as L}from"./CnEnsHnL.js";import{t as R}from"./CNdGjGfk.js";import{t as z}from"./Dc30IiQz.js";import{a as B,i as te,n as V,o as H,r as U}from"./BtRg635b.js";import{A as ne,C as W,E as G,G as K,J as q,N as re,O as ie,R as J,S as Y,d as X,i as ae,j as Z,m as Q,x as $,z as oe}from"./Dq3bNNT9.js";import{a as se,i as ce,n as le,o as ue,r as de,t as fe}from"./CFkJULj_.js";import{t as pe}from"./BLNk-Hhf.js";import{g as me,v as he}from"./Ch85hcd-.js";import{n as ge,t as _e}from"./x5MwCfWL.js";import{t as ve}from"./C7AIHFoL.js";import{t as ye}from"./E1qO1bOd.js";import{l as be}from"./DwNTAuCO.js";var xe={class:`flex min-w-0 items-center gap-1 text-sm font-bold whitespace-nowrap uppercase sm:text-xl`},Se=N({__name:`LogoText`,setup(e){let n=t(),r=l(()=>!!n.currentEndpoint);return(e,t)=>{let n=m;return O(),_(`div`,xe,[S(n,{class:`bg-gradient-to-br from-primary to-secondary bg-clip-text text-transparent no-underline`,to:d(r)?`/`:`/setup`},{default:k(()=>[...t[0]||=[j(`span`,{class:`hidden min-[400px]:inline`},`metacube`,-1),j(`span`,{class:`inline min-[400px]:hidden`},`mcx`,-1)]]),_:1},8,[`to`]),t[1]||=j(`span`,{class:`text-base-content`},`(`,-1),t[2]||=j(`a`,{class:`inline-block text-primary no-underline transition-transform duration-300 ease-in-out hover:scale-125 hover:rotate-90`,href:`https://github.com/metacubex/metacubexd`,target:`_blank`},` xd `,-1),t[3]||=j(`span`,{class:`text-base-content`},`)`,-1)])}}}),Ce=Object.assign(Se,{__name:`LogoText`}),we={class:`relative`},Te={class:`m-0 list-none p-1.5`},Ee=[`onClick`],De={key:0,class:`flex h-4 w-4 items-center justify-center text-primary`},Oe=N({__name:`LangSwitcher`,setup(t){let{locale:n,locales:r,setLocale:i}=F(),o=l(()=>r.value.map(e=>typeof e==`string`?{code:e,name:e}:e)),s=I(null),u=I(null),f=I(!1),{floatingStyles:m}=V(s,u,{placement:`top`,middleware:[B(10),te(),H({padding:8})],whileElementsMounted:U});function y(){f.value=!f.value}function x(e){i(e),f.value=!1}function C(e){let t=e.target;!s.value?.contains(t)&&!u.value?.contains(t)&&(f.value=!1)}return M(()=>{document.addEventListener(`click`,C)}),b(()=>{document.removeEventListener(`click`,C)}),(t,r)=>(O(),_(`div`,we,[j(`button`,{ref_key:`reference`,ref:s,class:D([`flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border-none bg-transparent text-base-content/70 transition-all duration-200 ease-in-out hover:bg-base-content/10 hover:text-base-content`,{"bg-primary/15 text-primary":d(f)}]),"aria-label":`Change language`,onClick:h(y,[`stop`])},[S(d(G),{size:18})],2),(O(),c(a,{to:`body`},[S(p,{"enter-active-class":`transition-opacity duration-150`,"leave-active-class":`transition-opacity duration-100`,"enter-from-class":`opacity-0`,"leave-to-class":`opacity-0`},{default:k(()=>[d(f)?(O(),_(`div`,{key:0,ref_key:`floating`,ref:u,style:e(d(m)),class:`z-70 w-40 overflow-hidden rounded-xl border border-base-content/10 bg-base-300/98 shadow-[0_10px_40px_var(--color-base-content)/20,0_0_0_1px_var(--color-base-content)/5] backdrop-blur-[12px]`},[r[1]||=j(`div`,{class:`flex items-center border-b border-base-content/8 bg-base-200/60 px-3 py-2.5`},[j(`span`,{class:`text-[0.6875rem] font-semibold tracking-[0.05em] text-base-content/50 uppercase`},`Language`)],-1),j(`ul`,Te,[(O(!0),_(g,null,P(d(o),e=>(O(),_(`li`,{key:e.code},[j(`button`,{class:D([`flex w-full cursor-pointer items-center justify-between rounded-lg border-none bg-transparent px-2.5 py-2 transition-all duration-150 ease-in-out hover:bg-base-content/8`,{"bg-primary/15 hover:bg-primary/20":d(n)===e.code}]),onClick:t=>x(e.code)},[j(`span`,{class:D([`text-[0.8125rem] font-medium text-base-content`,{"text-primary":d(n)===e.code}])},T(e.name),3),d(n)===e.code?(O(),_(`div`,De,[...r[0]||=[j(`svg`,{xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 20 20`,fill:`currentColor`,class:`h-full w-full`},[j(`path`,{"fill-rule":`evenodd`,d:`M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z`,"clip-rule":`evenodd`})],-1)]])):v(``,!0)],10,Ee)]))),128))])],4)):v(``,!0)]),_:1})]))]))}}),ke=Object.assign(Oe,{__name:`LangSwitcher`}),Ae={class:`relative`},je=N({__name:`ThemeSwitcher`,setup(t){let n=R(),r=I(null),i=I(null),o=I(!1),{floatingStyles:s}=V(r,i,{placement:`top`,middleware:[B(10),te(),H({padding:8})],whileElementsMounted:U});function l(){o.value=!o.value}function u(e){n.curTheme=e,document.documentElement.setAttribute(`data-theme`,e),o.value=!1}function f(e){let t=e.target;!r.value?.contains(t)&&!i.value?.contains(t)&&(o.value=!1)}return M(()=>{document.addEventListener(`click`,f)}),b(()=>{document.removeEventListener(`click`,f)}),(t,f)=>{let m=ue;return O(),_(`div`,Ae,[j(`button`,{ref_key:`reference`,ref:r,class:D([`flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border-none bg-primary text-primary-content transition-all duration-200 ease-in-out hover:scale-110 hover:shadow-[0_4px_12px_oklch(var(--p)/0.4)]`,{"scale-110 rotate-[15deg]":d(o)}]),onClick:h(l,[`stop`])},[S(d($),{size:18})],2),(O(),c(a,{to:`body`},[S(p,{"enter-active-class":`transition-opacity duration-150`,"leave-active-class":`transition-opacity duration-100`,"enter-from-class":`opacity-0`,"leave-to-class":`opacity-0`},{default:k(()=>[d(o)?(O(),_(`div`,{key:0,ref_key:`floating`,ref:i,style:e(d(s)),class:`z-70 w-44 overflow-hidden rounded-xl shadow-lg`},[f[0]||=j(`div`,{class:`flex items-center border-b border-gray-700 bg-gray-800/90 px-3 py-2`},[j(`span`,{class:`text-[0.6875rem] font-semibold tracking-[0.05em] text-gray-400 uppercase`},` Theme `)],-1),S(m,{"model-value":d(n).curTheme,"onUpdate:modelValue":u},null,8,[`model-value`])],4)):v(``,!0)]),_:1})]))])}}}),Me=Object.assign(je,{__name:`ThemeSwitcher`}),Ne={class:`mx-2 mb-2 overflow-hidden rounded-2xl shadow-lg backdrop-blur-[12px]`,style:{border:`1px solid color-mix(in oklch, var(--color-base-content) 10%, transparent)`,background:`color-mix(in oklch, var(--color-base-300) 90%, transparent)`}},Pe={class:`grid h-16 grid-cols-6`},Fe={class:`sr-only`},Ie=N({__name:`MobileBottomNav`,props:{navItems:{}},setup(e){let t=i(),n=e=>t.path===e,r=I(!1);return M(()=>{requestAnimationFrame(()=>{r.value=!0})}),(t,i)=>{let a=m;return O(),_(`nav`,{"aria-label":`Mobile bottom navigation`,class:D([`fixed inset-x-0 bottom-0 z-50 transition-all duration-500 ease-[cubic-bezier(0.22,1,0.36,1)] lg:hidden`,d(r)?`translate-y-0 opacity-100`:`translate-y-full opacity-0`])},[j(`div`,Ne,[j(`div`,Pe,[(O(!0),_(g,null,P(e.navItems,e=>(O(),c(a,{key:e.href,to:e.href,class:D([`group relative flex flex-col items-center justify-center gap-0.5 no-underline transition-all duration-300 ease-in-out active:scale-90`,n(e.href)?`text-primary`:`text-base-content/60 hover:text-base-content`])},{default:k(()=>[j(`div`,{class:D([`absolute inset-1 rounded-xl transition-all duration-300 ease-in-out`,n(e.href)?`bg-primary/10`:`bg-transparent group-hover:bg-base-content/5`])},null,2),j(`div`,{class:D([`absolute top-1 h-1 rounded-full bg-primary transition-all duration-300 ease-in-out`,n(e.href)?`w-8 opacity-100`:`w-0 opacity-0`])},null,2),j(`div`,{class:D([`relative z-10 transition-all duration-300 ease-in-out group-hover:scale-105`,n(e.href)?`scale-110 text-xl`:`scale-100 text-lg`])},[(O(),c(C(e.icon)))],2),j(`span`,Fe,T(`Navigate to ${e.name}`),1),j(`span`,{"aria-hidden":`true`,class:D([`relative z-10 text-[10px] font-medium transition-all duration-300 ease-in-out group-hover:opacity-100`,n(e.href)?`opacity-100`:`opacity-80`])},T(e.name),3)]),_:2},1032,[`to`,`class`]))),128))])])],2)}}}),Le=Object.assign(Ie,{__name:`MobileBottomNav`}),Re={class:`drawer-content flex h-full flex-col`},ze={class:`z-50 flex h-14 items-center gap-2 border-b border-[var(--sidebar-border)] bg-[color-mix(in_oklch,var(--color-base-300)_95%,transparent)] px-2 shadow-[0_4px_20px_color-mix(in_oklch,var(--color-base-content)_5%,transparent)] backdrop-blur-[12px] sm:px-4 lg:hidden`},Be={key:0,for:`main-drawer`,class:`flex h-9 w-9 cursor-pointer items-center justify-center rounded-lg bg-transparent text-base-content transition-all duration-200 ease-in-out hover:bg-[var(--sidebar-hover)]`,"aria-label":`open sidebar`},Ve={class:`min-w-0 shrink`},He={class:`ml-auto flex shrink-0 items-center gap-1`},Ue={key:0,class:`drawer-side z-[60]`},We={class:`flex shrink-0 flex-col gap-2 border-b border-[var(--sidebar-border)] p-3`},Ge={class:`flex-1 overflow-y-auto p-2`},Ke={class:`m-0 flex list-none flex-col gap-1 p-0`},qe={class:`flex shrink-0 items-center justify-center transition-transform duration-200 ease-in-out group-hover:scale-110`},Je={key:0,class:`absolute top-1/2 left-0 h-[60%] w-[3px] -translate-y-1/2 animate-[indicatorIn_0.2s_ease-out] rounded-r-sm bg-primary`},Ye=N({__name:`Sidebar`,setup(t){let n=i(),{t:r}=F(),a=R(),s=l(()=>[{href:`/overview`,name:r(`overview`),icon:ie},{href:`/proxies`,name:r(`proxies`),icon:Z},{href:`/rules`,name:r(`rules`),icon:Q},{href:`/connections`,name:r(`connections`),icon:Y},{href:`/logs`,name:r(`logs`),icon:re},{href:`/config`,name:r(`config`),icon:X}]),u=e=>n.path===e,f=I(null);A(()=>n.path,()=>{f.value&&(f.value.checked=!1)});let p=()=>{a.sidebarExpanded=!a.sidebarExpanded};return(t,i)=>{let l=Ce,h=ke,y=Me,b=m,E=se,ee=Le;return O(),_(`div`,{class:D([`drawer h-full [--sidebar-border:color-mix(in_oklch,var(--color-base-content)_10%,transparent)] [--sidebar-hover:color-mix(in_oklch,var(--color-base-content)_5%,transparent)]`,{"lg:drawer-open":d(n).path!==`/setup`}])},[j(`input`,{id:`main-drawer`,ref_key:`drawerCheckbox`,ref:f,type:`checkbox`,class:`drawer-toggle`},null,512),j(`div`,Re,[j(`header`,ze,[d(n).path!==`/setup`&&!d(a).useMobileBottomNav?(O(),_(`label`,Be,[S(d(W),{class:`h-5 w-5`})])):v(``,!0),j(`div`,Ve,[S(l)]),j(`div`,He,[i[0]||=j(`div`,{id:`header-traffic-indicator`,class:`flex items-center`},null,-1),S(h),S(y)])]),j(`div`,{class:D([`flex min-h-0 flex-1 flex-col p-2 sm:p-4`,d(a).useMobileBottomNav&&d(n).path!==`/setup`?`pb-[4.5rem] lg:pb-4`:``])},[x(t.$slots,`default`,{},void 0,!0)],2)]),d(n).path===`/setup`?v(``,!0):(O(),_(`div`,Ue,[i[1]||=j(`label`,{for:`main-drawer`,"aria-label":`close sidebar`,class:`drawer-overlay bg-[color-mix(in_oklch,var(--color-base-content)_40%,transparent)] backdrop-blur-[4px]`},null,-1),j(`div`,{class:D([`flex h-full w-52 flex-col border-r border-[var(--sidebar-border)] bg-[linear-gradient(180deg,color-mix(in_oklch,var(--color-base-200)_98%,transparent)_0%,var(--color-base-200)_100%)] backdrop-blur-[12px] transition-[width] duration-300 ease-[cubic-bezier(0.4,0,0.2,1)]`,d(a).sidebarExpanded?``:`lg:w-16`])},[j(`div`,We,[j(`div`,{class:D([`flex items-center`,d(a).sidebarExpanded?``:`lg:justify-center`])},[w(S(l,{class:`hidden lg:block`},null,512),[[o,d(a).sidebarExpanded]]),S(l,{class:`block lg:hidden`})],2),j(`button`,{class:D([`hidden w-full cursor-pointer items-center justify-center gap-2 rounded-lg border border-[var(--sidebar-border)] bg-transparent p-2 text-sm text-base-content transition-all duration-200 ease-in-out hover:border-[color-mix(in_oklch,var(--color-base-content)_20%,transparent)] hover:bg-[var(--sidebar-hover)] lg:flex`,d(a).sidebarExpanded?``:`aspect-square w-auto`]),onClick:p},[d(a).sidebarExpanded?(O(),c(d(oe),{key:1,class:`h-5 w-5`})):(O(),c(d(J),{key:0,class:`h-5 w-5`})),j(`span`,{class:D(d(a).sidebarExpanded?``:`lg:hidden`)},T(d(r)(`collapse`)),3)],2)]),j(`nav`,Ge,[j(`ul`,Ke,[(O(!0),_(g,null,P(d(s),(t,n)=>(O(),_(`li`,{key:t.href,class:`animate-[slideIn_0.3s_ease-out_backwards]`,style:e({animationDelay:`${n*50}ms`})},[S(b,{to:t.href,class:D([`relative flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-[color-mix(in_oklch,var(--color-base-content)_70%,transparent)] no-underline transition-all duration-200 ease-in-out hover:bg-[var(--sidebar-hover)] hover:text-base-content`,[u(t.href)?`bg-[color-mix(in_oklch,var(--color-primary)_15%,transparent)] !text-primary hover:bg-[color-mix(in_oklch,var(--color-primary)_20%,transparent)]`:``,d(a).sidebarExpanded?``:`lg:justify-center lg:px-0`]]),title:d(a).sidebarExpanded?void 0:t.name},{default:k(()=>[j(`div`,qe,[(O(),c(C(t.icon),{class:`h-5 w-5`}))]),j(`span`,{class:D([`flex-1 overflow-hidden text-ellipsis whitespace-nowrap`,d(a).sidebarExpanded?``:`lg:hidden`])},T(t.name),3),u(t.href)?(O(),_(`div`,Je)):v(``,!0)]),_:2},1032,[`to`,`class`,`title`])],4))),128))])]),j(`div`,{class:D([`shrink-0 border-t border-[var(--sidebar-border)] p-2`,d(a).sidebarExpanded?``:`lg:flex lg:flex-col lg:items-center`])},[j(`div`,{id:`sidebar-traffic-expanded`,class:D([`mb-2 hidden w-full`,d(a).sidebarExpanded?`lg:block`:``])},null,2),j(`div`,{id:`sidebar-traffic-indicator`,class:D([`mb-2 hidden w-full lg:block`,d(a).sidebarExpanded?`lg:!hidden`:``])},null,2),j(`div`,{class:D([`mb-2 hidden items-center gap-1 lg:flex`,d(a).sidebarExpanded?`flex-row`:`flex-col`])},[S(h),S(y)],2),S(E,{collapsed:!d(a).sidebarExpanded},null,8,[`collapsed`])],2)],2)])),d(a).useMobileBottomNav&&d(n).path!==`/setup`?(O(),c(ee,{key:1,"nav-items":d(s)},null,8,[`nav-items`])):v(``,!0)],2)}}}),Xe=Object.assign(pe(Ye,[[`__scopeId`,`data-v-1a22ffaf`]]),{__name:`Sidebar`});const Ze=globalThis.setInterval;function Qe(){let e=t(),n=ge(),r=z(),i=ve(),a=R(),o=null,s=null,c=null,l=null,u=null,d=(t,n)=>{let r=e.currentEndpoint;if(!r)return null;let i=e.wsEndpointURL,a=r.secret,o=new URLSearchParams;a&&o.set(`token`,a);let s=new WebSocket(`${i}/${t}?${o.toString()}`);return s.onmessage=e=>{try{n(JSON.parse(e.data))}catch{}},s.onerror=e=>{console.error(`WebSocket error for ${t}:`,e)},s};return{connect:()=>{if(me()){let e=he();n.updateFromWsMsg({connections:e.mockConnections,uploadTotal:e.mockTrafficStats.up,downloadTotal:e.mockTrafficStats.down}),r.setLatestTraffic(e.mockTrafficStats),r.setLatestMemory(e.mockMemory);let t=Date.now(),a=e.mockConnections.length;for(let n=30;n>=0;n--){let i=t-n*1e3,o=e.mockTrafficStats.down+Math.floor(Math.random()*1e5)-5e4,s=e.mockTrafficStats.up+Math.floor(Math.random()*2e4)-1e4,c=e.mockMemory.inuse+Math.floor(Math.random()*5e6)-25e5,l=a+Math.floor(Math.random()*10)-5;r.addTrafficDataPoint(i,o,s),r.addMemoryDataPoint(i,c),r.addConnectionCountDataPoint(i,l)}e.mockLogs.forEach(e=>{i.addLog(e)}),u=Ze(()=>{let t=Date.now(),n={up:e.mockTrafficStats.up+Math.floor(Math.random()*1e4),down:e.mockTrafficStats.down+Math.floor(Math.random()*5e4)};r.setLatestTraffic(n),r.addTrafficDataPoint(t,n.down,n.up);let i={inuse:e.mockMemory.inuse+Math.floor(Math.random()*5e6)-25e5,oslimit:e.mockMemory.oslimit};r.setLatestMemory(i),r.addMemoryDataPoint(t,i.inuse);let a=e.mockConnections.length+Math.floor(Math.random()*10)-5;r.addConnectionCountDataPoint(t,a)},1e3);return}o=d(`connections`,e=>{let t=e;if(n.updateFromWsMsg(t),t){let e=t.connections?.length??0;r.addConnectionCountDataPoint(Date.now(),e)}}),s=d(`traffic`,e=>{let t=e;r.setLatestTraffic(t),r.addTrafficDataPoint(Date.now(),t.down,t.up)}),c=d(`memory`,e=>{let t=e;r.setLatestMemory(t),r.addMemoryDataPoint(Date.now(),t.inuse)});let t=e.currentEndpoint;if(t){let n=e.wsEndpointURL,r=new URLSearchParams;t.secret&&r.set(`token`,t.secret),r.set(`level`,a.logLevel),l=new WebSocket(`${n}/logs?${r.toString()}`),l.onmessage=e=>{try{let t=JSON.parse(e.data);i.addLog(t)}catch{}}}},disconnect:()=>{u&&=(clearInterval(u),null),o?.close(),s?.close(),c?.close(),l?.close(),o=null,s=null,c=null,l=null},reconnectLogs:()=>{l?.close();let t=e.currentEndpoint;if(t){let n=e.wsEndpointURL,r=new URLSearchParams;t.secret&&r.set(`token`,t.secret),r.set(`level`,a.logLevel),l=new WebSocket(`${n}/logs?${r.toString()}`),l.onmessage=e=>{try{let t=JSON.parse(e.data);i.addLog(t)}catch{}}}}}}var $e={class:`hidden`},et=N({__name:`ProtectedResources`,setup(e){let{connect:t,disconnect:n,reconnectLogs:r}=Qe(),i=R();return M(()=>{t()}),b(()=>{n()}),A(()=>i.logLevel,()=>{r()}),(e,t)=>(O(),_(`div`,$e))}}),tt=Object.assign(et,{__name:`ProtectedResources`}),nt=f(ye(),1),rt={class:`flex items-center gap-1`},it={class:`font-mono text-xs`},at={class:`flex items-center gap-1`},ot={class:`font-mono text-xs`},st={class:`flex items-center justify-center gap-1`},ct={class:`font-mono text-xs`},lt={class:`flex items-center justify-center gap-1`},ut={class:`font-mono text-xs`},dt={key:0,class:`w-full rounded-lg bg-[color-mix(in_oklch,var(--color-base-100)_50%,transparent)] p-2`},ft={class:`grid grid-cols-2 gap-1 text-xs`},pt={class:`flex items-center gap-1`},mt={class:`truncate font-mono text-xs`},ht={class:`flex items-center gap-1`},gt={class:`truncate font-mono text-xs`},_t={class:`flex items-center gap-1`},vt={class:`font-mono text-xs`},yt={class:`flex items-center gap-1`},bt={class:`font-mono text-xs`},xt=[`title`],St={class:`flex flex-col gap-2 p-3`},Ct={class:`flex items-center justify-between gap-2`},wt={class:`text-xs font-semibold uppercase opacity-60`},Tt={class:`flex items-center gap-1`},Et=[`title`],Dt=[`title`],Ot={class:`grid grid-cols-2 gap-x-4 gap-y-1 text-xs`},kt={class:`flex items-center gap-1`},At={class:`font-mono text-xs font-medium`},jt={class:`flex items-center gap-1`},Mt={class:`font-mono text-xs font-medium`},Nt={class:`flex items-center gap-1 opacity-70`},Pt={class:`font-mono text-xs`},Ft={class:`flex items-center gap-1 opacity-70`},It={class:`font-mono text-xs`},Lt=N({__name:`GlobalTrafficIndicator`,setup(t){let r=z(),i=ge(),o=R(),s=n(`globalTrafficIndicatorVisible`,!0),u=n(`globalTrafficIndicatorCollapsed`,!0),f=n(`globalTrafficIndicatorPosition`,{x:-1,y:-1}),m=I(!1),h=I({x:0,y:0}),b=I(null),x=I(null),C,w=l(()=>r.latestTraffic?.down??0),E=l(()=>r.latestTraffic?.up??0),N=l(()=>r.latestMemory?.inuse??0),P=l(()=>i.latestConnectionMsg?.connections?.length??0),F=e=>_e(e).toString(),L=l(()=>f.value.x===-1||f.value.y===-1?{right:`16px`,bottom:`16px`}:{left:`${f.value.x}px`,top:`${f.value.y}px`});function B(){s.value=!s.value}function te(){u.value=!u.value}function V(){u.value=!1,f.value={x:-1,y:-1}}function H(e){if(!b.value)return;m.value=!0;let t=b.value.getBoundingClientRect(),n=`touches`in e?e.touches[0].clientX:e.clientX,r=`touches`in e?e.touches[0].clientY:e.clientY;h.value={x:n-t.left,y:r-t.top},f.value.x===-1&&(f.value.x=t.left,f.value.y=t.top),document.addEventListener(`mousemove`,U),document.addEventListener(`mouseup`,W),document.addEventListener(`touchmove`,U),document.addEventListener(`touchend`,W)}function U(e){if(!m.value)return;let t=`touches`in e?e.touches[0].clientX:e.clientX,n=`touches`in e?e.touches[0].clientY:e.clientY,r=t-h.value.x,i=n-h.value.y,a=b.value?.getBoundingClientRect(),o=a?.width||200,s=a?.height||150;r=Math.max(0,Math.min(window.innerWidth-o,r)),i=Math.max(0,Math.min(window.innerHeight-s,i)),f.value.x=r,f.value.y=i}function W(){m.value&&(m.value=!1,document.removeEventListener(`mousemove`,U),document.removeEventListener(`mouseup`,W),document.removeEventListener(`touchmove`,U),document.removeEventListener(`touchend`,W))}function G(){if(!x.value)return;C&&=(C.destroy(),void 0);let e=be(),t=x.value.offsetWidth||200;C=nt.default.chart(x.value,{chart:{type:`areaspline`,backgroundColor:`transparent`,spacing:[0,0,0,0],margin:[0,0,0,0],animation:!1,width:t,height:48},credits:{enabled:!1},accessibility:{enabled:!1},title:{text:void 0},legend:{enabled:!1},xAxis:{visible:!1,type:`datetime`},yAxis:{visible:!1,min:0},tooltip:{enabled:!1},plotOptions:{areaspline:{lineWidth:1.5,marker:{enabled:!1},fillOpacity:.2,animation:!1}},series:[{type:`areaspline`,name:`Upload`,color:e.seriesColors[0],data:r.trafficChartHistory.upload.length>0?[...r.trafficChartHistory.upload].slice(-30):[[Date.now(),0]]},{type:`areaspline`,name:`Download`,color:e.seriesColors[1],data:r.trafficChartHistory.download.length>0?[...r.trafficChartHistory.download].slice(-30):[[Date.now(),0]]}]})}function re(){if(!C)return;let e=[...r.trafficChartHistory.download].slice(-30),t=[...r.trafficChartHistory.upload].slice(-30);C.series[0]?.setData(t,!1),C.series[1]?.setData(e,!0)}function ie(){if(!$)return;let e=[...r.trafficChartHistory.download].slice(-30),t=[...r.trafficChartHistory.upload].slice(-30);$.series[0]?.setData(t,!1),$.series[1]?.setData(e,!0)}function J(){if(!Q.value)return;$&&=($.destroy(),void 0);let e=be();$=nt.default.chart(Q.value,{chart:{type:`areaspline`,backgroundColor:`transparent`,spacing:[0,0,0,0],margin:[0,0,0,0],animation:!1,height:40},credits:{enabled:!1},accessibility:{enabled:!1},title:{text:void 0},legend:{enabled:!1},xAxis:{visible:!1,type:`datetime`},yAxis:{visible:!1,min:0},tooltip:{enabled:!1},plotOptions:{areaspline:{lineWidth:1.5,marker:{enabled:!1},fillOpacity:.2,animation:!1}},series:[{type:`areaspline`,name:`Upload`,color:e.seriesColors[0],data:r.trafficChartHistory.upload.length>0?[...r.trafficChartHistory.upload].slice(-30):[[Date.now(),0]]},{type:`areaspline`,name:`Download`,color:e.seriesColors[1],data:r.trafficChartHistory.download.length>0?[...r.trafficChartHistory.download].slice(-30):[[Date.now(),0]]}]})}A(()=>r.latestTraffic,e=>{e&&(C?re():x.value&&s.value&&!u.value&&G(),$?ie():Q.value&&J())}),A(()=>o.curTheme,()=>{x.value&&!u.value&&s.value&&G(),Q.value&&J()}),A(u,e=>{!e&&s.value?y(()=>{setTimeout(()=>{x.value&&r.latestTraffic&&G()},50)}):e&&C&&(C.destroy(),C=void 0)}),A(s,e=>{e&&!u.value?y(()=>{setTimeout(()=>{x.value&&r.latestTraffic&&G()},50)}):!e&&C&&(C.destroy(),C=void 0)}),A(()=>o.sidebarExpanded,e=>{e&&y(()=>{setTimeout(()=>{Q.value&&r.latestTraffic&&J()},100)})});let Y=I(!1),X=I(!1),Z=I(!1),Q=I(null),$;return M(()=>{y(()=>{Y.value=!!document.getElementById(`header-traffic-indicator`),X.value=!!document.getElementById(`sidebar-traffic-indicator`),Z.value=!!document.getElementById(`sidebar-traffic-expanded`)}),s.value&&!u.value&&r.latestTraffic&&setTimeout(()=>{x.value&&G()},100),r.latestTraffic&&setTimeout(()=>{Q.value&&J()},150)}),ee(()=>{C&&=(C.destroy(),void 0),$&&=($.destroy(),void 0)}),(t,n)=>(O(),_(g,null,[d(Y)?(O(),c(a,{key:0,to:`#header-traffic-indicator`},[d(s)&&d(u)&&d(r).latestTraffic?(O(),_(`div`,{key:0,class:`flex cursor-pointer items-center gap-2 rounded-lg bg-[color-mix(in_oklch,var(--color-base-100)_50%,transparent)] px-2 py-1 transition-[background] duration-200 ease-in-out hover:bg-[var(--color-base-100)]`,onClick:V},[j(`div`,rt,[S(d(q),{class:`size-3 shrink-0 text-[var(--color-success)]`}),j(`span`,it,T(F(d(w)))+`/s`,1)]),n[0]||=j(`div`,{class:`h-3 w-px bg-[color-mix(in_oklch,var(--color-base-content)_20%,transparent)]`},null,-1),j(`div`,at,[S(d(K),{class:`size-3 shrink-0 text-[var(--color-info)]`}),j(`span`,ot,T(F(d(E)))+`/s`,1)])])):v(``,!0)])):v(``,!0),d(X)?(O(),c(a,{key:1,to:`#sidebar-traffic-indicator`},[d(r).latestTraffic?(O(),_(`div`,{key:0,class:`w-full cursor-pointer rounded-lg bg-[color-mix(in_oklch,var(--color-base-100)_50%,transparent)] p-2 transition-[background] duration-200 ease-in-out hover:bg-[var(--color-base-100)]`,onClick:V},[j(`div`,st,[S(d(q),{class:`size-3 shrink-0 text-[var(--color-success)]`}),j(`span`,ct,T(F(d(w)))+`/s`,1)]),j(`div`,lt,[S(d(K),{class:`size-3 shrink-0 text-[var(--color-info)]`}),j(`span`,ut,T(F(d(E)))+`/s`,1)])])):v(``,!0)])):v(``,!0),d(Z)?(O(),c(a,{key:2,to:`#sidebar-traffic-expanded`},[d(r).latestTraffic?(O(),_(`div`,dt,[j(`div`,{ref_key:`sidebarChartContainer`,ref:Q,class:`mb-2 h-10 w-full`},null,512),j(`div`,ft,[j(`div`,pt,[S(d(q),{class:`size-3 shrink-0 text-[var(--color-success)]`}),j(`span`,mt,T(F(d(w)))+`/s`,1)]),j(`div`,ht,[S(d(K),{class:`size-3 shrink-0 text-[var(--color-info)]`}),j(`span`,gt,T(F(d(E)))+`/s`,1)])])])):v(``,!0)])):v(``,!0),d(s)&&d(u)&&d(r).latestTraffic&&!d(Y)&&!d(X)?(O(),_(`div`,{key:3,class:`fixed right-4 bottom-4 z-50 flex cursor-pointer items-center gap-2 rounded-xl bg-[var(--color-base-200)] px-3 py-2 shadow-lg`,onClick:V},[j(`div`,_t,[S(d(q),{class:`size-3 shrink-0 text-[var(--color-success)]`}),j(`span`,vt,T(F(d(w)))+`/s`,1)]),n[1]||=j(`div`,{class:`h-3 w-px bg-[color-mix(in_oklch,var(--color-base-content)_20%,transparent)]`},null,-1),j(`div`,yt,[S(d(K),{class:`size-3 shrink-0 text-[var(--color-info)]`}),j(`span`,bt,T(F(d(E)))+`/s`,1)])])):v(``,!0),d(s)?v(``,!0):(O(),_(`button`,{key:4,class:`fixed right-4 bottom-4 z-50 flex size-8 cursor-pointer items-center justify-center rounded-full border-none bg-[var(--color-primary)] text-[var(--color-primary-content)] shadow-lg transition-all duration-200 ease-in-out hover:scale-110`,title:t.$t(`showTrafficIndicator`),onClick:B},[S(d(K),{class:`size-4`})],8,xt)),S(p,{name:`traffic-expand`},{default:k(()=>[d(s)&&!d(u)&&d(r).latestTraffic?(O(),_(`div`,{key:0,ref_key:`containerRef`,ref:b,class:D([`fixed z-50 min-w-56 rounded-xl bg-[var(--color-base-200)] shadow-lg select-none`,{"cursor-grabbing":d(m)}]),style:e(d(L))},[j(`div`,St,[j(`div`,Ct,[j(`div`,{class:`flex cursor-grab items-center gap-1 active:cursor-grabbing`,onMousedown:H,onTouchstart:H},[S(d(ne),{class:`size-4 opacity-40`}),j(`span`,wt,T(t.$t(`traffic`)),1)],32),j(`div`,Tt,[j(`button`,{class:`flex size-6 cursor-pointer items-center justify-center rounded-full border-none bg-transparent text-[var(--color-base-content)] transition-[background] duration-200 ease-in-out hover:bg-[color-mix(in_oklch,var(--color-base-content)_10%,transparent)]`,title:t.$t(`hideTrafficIndicator`),onClick:te},[...n[2]||=[j(`span`,{class:`text-xs`},`âˆ’`,-1)]],8,Et),j(`button`,{class:`flex size-6 cursor-pointer items-center justify-center rounded-full border-none bg-transparent text-[var(--color-base-content)] transition-[background] duration-200 ease-in-out hover:bg-[color-mix(in_oklch,var(--color-base-content)_10%,transparent)]`,title:t.$t(`hideTrafficIndicator`),onClick:B},[S(d(ae),{class:`size-3`})],8,Dt)])]),j(`div`,{ref_key:`chartContainer`,ref:x,class:`h-12 w-full`},null,512),j(`div`,Ot,[j(`div`,kt,[S(d(q),{class:`size-3 shrink-0 text-[var(--color-success)]`}),j(`span`,At,T(F(d(w)))+`/s `,1)]),j(`div`,jt,[S(d(K),{class:`size-3 shrink-0 text-[var(--color-info)]`}),j(`span`,Mt,T(F(d(E)))+`/s `,1)]),j(`div`,Nt,[j(`span`,null,T(t.$t(`memory`))+`:`,1),j(`span`,Pt,T(F(d(N))),1)]),j(`div`,Ft,[j(`span`,null,T(t.$t(`connections`))+`:`,1),j(`span`,It,T(d(P)),1)])])])],6)):v(``,!0)]),_:1})],64))}}),Rt=Object.assign(pe(Lt,[[`__scopeId`,`data-v-b584cc8c`]]),{__name:`GlobalTrafficIndicator`}),zt={class:`modal-box max-w-lg`},Bt={class:`flex items-center justify-between border-b border-base-300 pb-3`},Vt={class:`text-lg font-bold`},Ht={class:`mt-4 space-y-6`},Ut={class:`mb-2 text-sm font-semibold text-base-content/70`},Wt={class:`space-y-1`},Gt={class:`text-sm`},Kt={class:`kbd kbd-sm`},qt={class:`mt-6 text-center text-xs text-base-content/50`},Jt=N({__name:`ShortcutsHelpModal`,setup(e){let t=fe(),{t:n}=F(),r=u(`(max-width: 768px)`),i=()=>{t.closeHelpModal()};return(e,a)=>d(r)?v(``,!0):(O(),_(`dialog`,{key:0,class:D([`modal`,{"modal-open":d(t).isHelpModalOpen}]),onClick:h(i,[`self`])},[j(`div`,zt,[j(`div`,Bt,[j(`h3`,Vt,T(d(n)(`shortcuts.title`,`Keyboard Shortcuts`)),1),j(`button`,{class:`btn btn-circle btn-ghost btn-sm`,onClick:i},[...a[0]||=[j(`span`,{class:`i-tabler-x size-5`},null,-1)]])]),j(`div`,Ht,[(O(!0),_(g,null,P(d(le),e=>(O(),_(`div`,{key:e.id},[j(`h4`,Ut,T(d(n)(e.labelKey,e.id)),1),j(`div`,Wt,[(O(!0),_(g,null,P(e.shortcuts,e=>(O(),_(`div`,{key:e,class:`flex items-center justify-between rounded px-2 py-1.5 hover:bg-base-200`},[j(`span`,Gt,T(d(n)(d(de)[e],e)),1),j(`kbd`,Kt,T(d(ce)(d(t).shortcuts[e])),1)]))),128))])]))),128))]),j(`div`,qt,T(d(n)(`shortcuts.pressEscToClose`,`Press Esc to close`)),1)]),j(`form`,{method:`dialog`,class:`modal-backdrop`,onClick:i},[...a[1]||=[j(`button`,null,`close`,-1)]])],2))}}),Yt=Object.assign(Jt,{__name:`ShortcutsHelpModal`});function Xt(){let e=s(),t=fe(),n=r(),i=l(()=>{let e=n.value;if(!e)return!1;let t=e.tagName.toLowerCase();return t===`input`||t===`textarea`||t===`select`||e.getAttribute(`contenteditable`)===`true`}),a=I(!1),o=I(null),c=()=>{a.value=!1,o.value&&=(clearTimeout(o.value),null)},u=()=>{a.value=!0,o.value&&clearTimeout(o.value),o.value=setTimeout(c,1500)},d={goToOverview:()=>e.push(L.Overview),goToProxies:()=>e.push(L.Proxies),goToConnections:()=>e.push(L.Conns),goToRules:()=>e.push(L.Rules),goToLogs:()=>e.push(L.Log),goToConfig:()=>e.push(L.Config),refresh:()=>{window.dispatchEvent(new CustomEvent(`shortcut:refresh`))},closeModal:()=>{t.isHelpModalOpen&&t.closeHelpModal(),window.dispatchEvent(new CustomEvent(`shortcut:close-modal`))},showHelp:()=>{t.toggleHelpModal()}},f=e=>{let t=d[e];t&&t()},p={o:`goToOverview`,p:`goToProxies`,c:`goToConnections`,u:`goToRules`,l:`goToLogs`,s:`goToConfig`},m=e=>{if(i.value)return;let t=e.key.toLowerCase();if(t===`escape`){f(`closeModal`);return}if(e.shiftKey&&(t===`/`||t===`?`)){e.preventDefault(),f(`showHelp`);return}if(t===`g`&&!a.value){u();return}if(a.value){let n=p[t];if(n){e.preventDefault(),f(n),c();return}}t===`r`&&!a.value&&f(`refresh`)};return b(()=>{window.removeEventListener(`keydown`,m),c()}),{isInputFocused:i,gPrefixActive:a,setupKeyboardListeners:()=>{window.addEventListener(`keydown`,m)},executeAction:f}}var Zt=[`data-theme`],Qt=N({__name:`default`,setup(e){let n=R(),r=t(),i=z();fe();let{setupKeyboardListeners:a}=Xt();M(()=>{a()});let o=I(null);A(o,e=>{e&&(i.rootElement=e)}),A([()=>n.autoSwitchTheme,E()],([e,t])=>{e&&(n.curTheme=t?n.favNightTheme:n.favDayTheme)},{immediate:!0}),A(()=>n.curTheme,e=>{document.documentElement.setAttribute(`data-theme`,e)},{immediate:!0});let s=l(()=>me()||!!r.currentEndpoint);return(e,t)=>{let r=Xe,i=tt,a=Rt,l=Yt;return O(),_(`div`,{ref_key:`rootElement`,ref:o,class:D([`relative h-screen overscroll-y-none bg-base-100 antialiased`,d(n).enableTwemoji?`font-twemoji`:`font-default`]),"data-theme":d(n).curTheme},[S(r,null,{default:k(()=>[x(e.$slots,`default`)]),_:3}),d(s)?(O(),c(i,{key:0})):v(``,!0),d(s)?(O(),c(a,{key:1})):v(``,!0),S(l)],10,Zt)}}});export{Qt as default};